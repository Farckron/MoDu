<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Habit Tracker</title>
  <!-- Progressive Web App metadata -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#58CC02" />
  <link rel="icon" type="image/png" href="icons/icon-192.png" />
  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="header">
    <h1 class="app-title">Habit Tracker</h1>
    <div class="stats">
      <div class="stat">
        <span class="label">XP:</span>
        <span id="xpValue">0</span>
      </div>
      <div class="stat">
        <span class="label">Level:</span>
        <span id="levelValue">1</span>
        <div class="level-bar">
          <div id="levelProgress"></div>
        </div>
      </div>
      <div class="stat">
        <span class="label">Freeze Tokens:</span>
        <span id="freezesValue">0</span>
        <button id="buyFreeze" class="btn secondary small" title="Spend 50 XP to earn one freeze token">Buy Freeze (50 XP)</button>
      </div>
    </div>
    <div id="motivation" class="motivation"></div>
  </header>

  <main class="container">
    <!-- Add habit form -->
    <section class="card add-habit">
      <h2>Add Habit</h2>
      <div class="form-grid">
        <div class="form-row">
          <label for="habitName">Name</label>
          <input id="habitName" type="text" placeholder="e.g. Morning workout" />
        </div>
        <div class="form-row">
          <label for="habitShort">Short name (unique)</label>
          <input id="habitShort" type="text" placeholder="e.g. workout" />
        </div>
        <div class="form-row">
          <label for="habitPeriod">Period</label>
          <div class="period-select">
            <select id="habitPeriod">
              <option value="daily">Daily</option>
              <option value="day after day">Day after day</option>
              <option value="times per week">Times per week</option>
            </select>
            <input id="habitCount" type="number" min="1" max="7" step="1" placeholder="#/wk" title="Times per week" class="count-input" />
          </div>
        </div>
      </div>
      <button id="addHabitBtn" class="btn primary">Add habit</button>
    </section>

    <!-- Toolbar actions -->
    <section class="toolbar card">
      <div class="toolbar-row">
        <input id="searchInput" type="text" placeholder="Filter by name or short…" />
        <button id="exportCsv" class="btn secondary">Export CSV</button>
        <button id="exportCompat" class="btn secondary" title="Export in pandas‑compatible format">Export CSV (compat)</button>
        <input id="fileImport" type="file" accept=".csv,.json" style="display:none" />
        <button id="importBtn" class="btn secondary">Import…</button>
        <button id="helpBtn" class="btn secondary">Help</button>
        <button id="clearBtn" class="btn danger">Clear all</button>
      </div>
    </section>

    <!-- Habits table -->
    <section class="card habits">
      <table id="habitTable">
        <thead>
          <tr>
            <th>Short</th>
            <th>Name</th>
            <th>Period</th>
            <th>Last done</th>
            <th>Streak</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="habitBody"></tbody>
      </table>
    </section>
  </main>

  <!-- Info dialog -->
  <dialog id="infoDialog" class="modal">
    <header>
      <h3>Habit info</h3>
      <button id="infoClose" class="btn small secondary">Close</button>
    </header>
    <pre id="infoContent" class="info-content"></pre>
    <div class="modal-actions">
      <button id="copyJson" class="btn primary small">Copy JSON</button>
    </div>
  </dialog>

  <!-- Help dialog -->
  <dialog id="helpDialog" class="modal">
    <header>
      <h3>Help</h3>
      <button id="helpClose" class="btn small secondary">Close</button>
    </header>
    <div class="help-content">
      <p>This version of the habit tracker introduces streaks, freeze tokens and XP like a game. Earn XP by completing habits and level up!</p>
      <ul>
        <li>Add a habit with a unique short name. Choose the period and, for <em>times per week</em>, set the weekly count.</li>
        <li>Mark <strong>Done</strong> each day you complete the habit. Your streak grows when you complete on consecutive days.</li>
        <li>If you miss a day, your streak resets – unless you have a <strong>freeze</strong> token! Use XP to buy freezes.</li>
        <li>Track your XP, level and freeze tokens in the header. The progress bar shows XP towards your next level.</li>
        <li>Use Export and Import to backup or restore your data. CSV (compat) matches a pandas DataFrame shape.</li>
      </ul>
    </div>
  </dialog>

  <!-- Toast notifications -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- JavaScript -->
  <script src="app.js"></script>
</body>
</html>